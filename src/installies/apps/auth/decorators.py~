from flask import g, redirect

def required_auth(
        required: bool,
        redirect_to: str,
        flash_message: str=None,
):
    """
    A decorater that checks if a user is authed before allowing them to access a page.

    :param required: If this true, users have to be authed to access the page, but if this is
    false then authed users are not allowed to accessed the page.

    :param redirect_to: The url to redirect to if the user is not allowed to access the page.

    :param flash_method: The message to flash if the user is not allowed to access the page.
    """
    def decorator(func):
        def wrapper(*args, **kwargs):
            if (g.is_authed == False and required == True) or (g.is_authed == True and required == False):
                if flash_message is not None:
                    flash(flash_message, 'error')
                return redirect(redirect_to)
            
            return func(*args, **kwargs)

        return wrapper
    return decorator
                
